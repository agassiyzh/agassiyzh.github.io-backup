<!doctype html><html lang=zn-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="小於"><title>在iOS单元测试中使用NSBundle ｜ 小於的宅基地</title><meta name=description content="最近开始整理项目的代码。找了一本《重构-改善既有代码的设计》来看。
一边整理一边写单元测试来确定新添加的方法是执行正确的。其中有一个方法死活通不过。这个方法中我使用了NSBundle来获取app中打包进去的资源。但是调试发现根本无法定位资源。"><meta name=keywords content="技术,园艺,Iot,生活,感悟,育儿"><link rel="shortcut icon" href=http://localhost:1313/images/favicon.ico><link rel=stylesheet type=text/css media=screen href=http://localhost:1313/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css><link rel=stylesheet type=text/css media=screen href=http://localhost:1313/css/zozo.css><link rel=stylesheet type=text/css media=screen href=http://localhost:1313/css/customize.css><link rel=stylesheet type=text/css media=screen href=https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css><link rel=stylesheet type=text/css media=screen href=http://localhost:1313/css/highlight.css></head><body><div class="main animate__animated animate__fadeInDown"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>Home</a></li><li><a href=/posts/>Archive</a></li><li><a href=/tags/>Tags</a></li><li><a href=/about/>About</a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=ri-menu-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=http://localhost:1313/><span>小於的宅基地</span></a></h1></div><div class=description><p class=sub_title>但愿每次回忆都不觉愧疚</p><div class=my_socials><a href=https://github.com/agassiyzh title=github target=_blank><i class=ri-github-fill></i></a><a href=https://twitter.com/agassi_yzh title=twitter target=_blank><i class=ri-twitter-fill></i></a><a href=http://localhost:1313/index.xml type=application/rss+xml title=rss target=_blank><i class=ri-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animate__animated animate__fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/use-nsbundle-in-unit-test/>在iOS单元测试中使用NSBundle</a></h2><span class=date>2012.08.28</span></div><div class="post_content markdown"><p>最近开始整理项目的代码。找了一本《重构-改善既有代码的设计》来看。</p><p>一边整理一边写单元测试来确定新添加的方法是执行正确的。其中有一个方法死活通不过。这个方法中我使用了<code>NSBundle</code>来获取app中打包进去的资源。但是调试发现根本无法定位资源。</p><p>后来在<a href="https://stackoverflow.com/questions/3067015/ocunit-nsbundle?answertab=active#tab-top">stackoverfolow</a>中看到是<code>[NSBundle mainBundle]</code>这个方法出的问题。Apple官方文档中对这个方法的解释是：</p><blockquote><p>This method allocates and initializes a bundle object if one doesn’t already exist. The new object corresponds to the directory where the application executable is located. Be sure to check the return value to make sure you have a valid bundle. This method may return a valid bundle object even for unbundled applications.</p></blockquote><blockquote><p>In general, the main bundle corresponds to an application file package or application wrapper: a directory that bears the name of the application and is marked by a “.app” extension.</p></blockquote><p><a href="https://stackoverflow.com/questions/3067015/ocunit-nsbundle?answertab=active#tab-top">stackoverfolow</a>对这个问题提出了解决方案。</p><p>可以用</p><div class=highlight><pre class=chroma><code class=language-objc data-lang=objc><span class=p>[[</span><span class=n>NSBundle</span> <span class=nl>bundleForClass</span><span class=p>:[</span><span class=n>myClass</span> <span class=k>class</span><span class=p>]]</span>
</code></pre></div><p>或者：</p><div class=highlight><pre class=chroma><code class=language-objc data-lang=objc><span class=p>[[</span><span class=n>NSBundle</span> <span class=nl>bundleForClass</span><span class=p>:[</span><span class=nb>self</span> <span class=k>class</span><span class=p>]]</span>
</code></pre></div><p>来替代<code>[NSBundle mainBundle]</code>。</p><p>这个看起来不错，但是我想在不是单元测试的时候用[NSBundle mainBundle]，这个时候可以参考我之前的一篇文章<a href>用同一套代码写不同版本的客户端</a></p><div class=highlight><pre class=chroma><code class=language-objc data-lang=objc><span class=cp>#ifdef UnitTest
</span><span class=cp></span><span class=n>NSURL</span> <span class=o>*</span><span class=n>bundleURL</span> <span class=o>=</span> <span class=p>[[</span><span class=n>NSBundle</span> <span class=nl>bundleForClass</span><span class=p>:[</span><span class=nb>self</span> <span class=k>class</span><span class=p>]]</span> <span class=nl>URLForResource</span><span class=p>:</span><span class=n>CLIENT_NAME</span> <span class=nl>withExtension</span><span class=p>:</span><span class=s>@&#34;bundle&#34;</span><span class=p>];</span>
<span class=cp>#else
</span><span class=cp></span><span class=n>NSURL</span> <span class=o>*</span><span class=n>bundleURL</span> <span class=o>=</span> <span class=p>[[</span><span class=n>NSBundle</span> <span class=n>mainBundle</span><span class=p>]</span> <span class=nl>URLForResource</span><span class=p>:</span><span class=n>CLIENT_NAME</span> <span class=nl>withExtension</span><span class=p>:</span><span class=s>@&#34;bundle&#34;</span><span class=p>];</span>
<span class=cp>#endif
</span></code></pre></div></div><div class=post_footer></div></div><div class=doc_comments></div></div></div></div><a id=back_to_top href=# class=back_to_top><i class=ri-arrow-up-s-line></i></a><footer class=footer><div class=powered_by><a href=https://varkai.com>Designed by VarKai,</a>
<a href=http://www.gohugo.io/>Proudly published with Hugo</a></div><div class=footer_slogan><span>人生没有白走的路，每一步都算数</span></div></footer><script src=http://localhost:1313/js/jquery-3.5.1.min.js></script><link href=http://localhost:1313/css/fancybox.min.css rel=stylesheet><script src=http://localhost:1313/js/fancybox.min.js></script><script src=http://localhost:1313/js/zozo.js></script><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\[\[','\]\]']],processEscapes:true,processEnvironments:true,skipTags:['script','noscript','style','textarea','pre'],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}});MathJax.Hub.Queue(function(){var all=MathJax.Hub.getAllJax(),i;for(i=0;i<all.length;i+=1){all[i].SourceElement().parentNode.className+=' has-jax';}});</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style></body></html>