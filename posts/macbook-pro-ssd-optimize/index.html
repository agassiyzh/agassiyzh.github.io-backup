<!doctype html><html lang=zn-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="小於"><title>Macbook pro SSD 优化小结 ｜ 小於的宅基地</title><meta name=description content="公司全体员工集体给Macbook pro换上了ssd型号是镁光 M4 128G。
虽然，我越来越信奉：“优化的第一原则就是：Do&amp;rsquo;t”这句话。
但是，ssd我还是第一次用，对我来说是个新鲜物什。所以w难免要折腾一翻。Google了下&amp;rdquo;Mac ssd 优化&amp;quot;，参考了下面几篇文章：
  Mac OS X 下与 SSD 相关的优化
  Mac下优化SSD
  纠结ssd寿命的看这里
  分享下 SSD for Macbook Pro 的优化"><meta name=keywords content="技术,园艺,Iot,生活,感悟,育儿"><link rel="shortcut icon" href=http://localhost:1313/images/favicon.ico><link rel=stylesheet type=text/css media=screen href=http://localhost:1313/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css><link rel=stylesheet type=text/css media=screen href=http://localhost:1313/css/zozo.css><link rel=stylesheet type=text/css media=screen href=http://localhost:1313/css/customize.css><link rel=stylesheet type=text/css media=screen href=https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css><link rel=stylesheet type=text/css media=screen href=http://localhost:1313/css/highlight.css></head><body><div class="main animate__animated animate__fadeInDown"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>Home</a></li><li><a href=/posts/>Archive</a></li><li><a href=/tags/>Tags</a></li><li><a href=/about/>About</a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=ri-menu-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=http://localhost:1313/><span>小於的宅基地</span></a></h1></div><div class=description><p class=sub_title>但愿每次回忆都不觉愧疚</p><div class=my_socials><a href=https://github.com/agassiyzh title=github target=_blank><i class=ri-github-fill></i></a><a href=https://twitter.com/agassi_yzh title=twitter target=_blank><i class=ri-twitter-fill></i></a><a href=http://localhost:1313/index.xml type=application/rss+xml title=rss target=_blank><i class=ri-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animate__animated animate__fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/macbook-pro-ssd-optimize/>Macbook pro SSD 优化小结</a></h2><span class=date>2011.12.19</span></div><div class="post_content markdown"><p><a href=https://www.v2ex.com/t/23709>公司全体员工集体给Macbook pro换上了ssd</a>型号是镁光 M4 128G。</p><p><img src=https://pic.yupoo.com/agassi/BBudd6Ir/medish.jpg alt=SSD></p><p>虽然，我越来越信奉：“优化的第一原则就是：Do&rsquo;t”这句话。</p><p>但是，ssd我还是第一次用，对我来说是个新鲜物什。所以w难免要折腾一翻。Google了下&rdquo;<a href="https://www.google.com/search?q=mac%20ssd%20%E4%BC%98%E5%8C%96">Mac ssd 优化</a>"，参考了下面几篇文章：</p><ul><li><p><a href=https://blog.jjgod.org/2010/04/17/macosx-ssd-tweaks/>Mac OS X 下与 SSD 相关的优化</a></p></li><li><p><a href=https://davidx.me/2011/09/24/optimize-ssd-on-mac/>Mac下优化SSD</a></p></li><li><p><a href=https://bbs.weiphone.com/read-htm-tid-2499589.html>纠结ssd寿命的看这里</a></p></li><li><p><a href=https://hi.baidu.com/omys/blog/item/67fc8a0e3a7d84fd37d1220b.html>分享下 SSD for Macbook Pro 的优化</a></p></li></ul><h2 id=性能优化>性能优化</h2><h3 id=关闭紧急运动传感器sudden-motion-sensor>关闭紧急运动传感器(Sudden Motion Sensor)</h3><p>这个功能很想Thinkpad下面的APS，对普通硬盘还是很有必要的。但是都固态了就完全没有必要了。</p><p>可以通过下面这条命令禁用：<code>$ sudo pmset -a sms 0</code></p><h3 id=四开三关trim>四开三关Trim</h3><p>![Trim2](<a href=https://pic.yupoo.com/agassi/BBtg2JqH/medium.jpg>https://pic.yupoo.com/agassi/BBtg2JqH/medium.jpg</a> 160)</p><p>这是一个比较纠结的问题,据<a href=https://weibo.com/xinquan>@xinquan</a>说，他用Intel G2的时候，这个功能是系统默认开启的。但是当我们换上镁光M4，Lion下并没有启用。</p><p>网上有一个小软件<a href="https://www.groths.org/?p=308">Tril enabler</a>可以强制开启。但是这个东西网上现在众说纷纭。</p><p>我第一次开启感觉删除东西明显变慢了，偶尔有卡顿的感觉。开机从一朵半变成了5朵。</p><p>最后在<a href="https://www.groths.org/?p=308">Trim enabler</a>的留言中我找到了这么一句话：</p><blockquote><p>TRIM is ALWAYS preferred over Garbage Collection and will likely yield better results. If you have garbage collection, you don’t necessarily need TRIM, but it’ll probably offer better performance and there’s always a chance there’ll be a degradation of speed over time. Therefore, when using Garbage Collection, you may have to take the drive out and do a secure erase so that everything is re-marked as free space.</p><p>Running garbage collection and TRIM at the same time is NOT a problem. They’re designed to work together. You can look at it like so: TRIM is called by your OS each time space is freed up. Garbage Collection is run by the drive’s firmware when idle and determines which parts of the drive can be cleaned up and rearranged. TRIM is obviously more efficient and obviously the drive’s firmware is aware of the TRIM commands and accounts for this.</p><p>All SSD manufacturers, GC or not, recommend the use of TRIM.</p></blockquote><p>作者提供了用命令行开启Trim支持的方法：</p><p>首先是备份你的硬件信息</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>sudo cp /System/Library/Extensions/IOAHCIFamily.kext/Contents/PlugIns/IOAHCIBlockStorage.kext/Contents/MacOS IOAHCIBlockStorage /System/Library/Extensions/IOAHCIFamily.kext/Contents/PlugIns/IOAHCIBlockStorage.kext/Contents/MacOS/IOAHCIBlockStorage.original
</code></pre></div><p>打开Trim支持</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>sudo perl -pi -e <span class=s1>&#39;s|(\x52\x6F\x74\x61\x74\x69\x6F\x6E\x61\x6C\x00{1,20})[^\x00]{9}(\x00{1,20}\x51)|$1\x00\x00\x00\x00\x00\x00\x00\x00\x00$2|sg&#39;</span> /System/Library/Extensions/IOAHCIFamily.kext/Contents/PlugIns/IOAHCIBlockStorage.kext/Contents/MacOS/IOAHCIBlockStorage
</code></pre></div><p>清楚系统内核缓存</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>sudo kextcache -system-prelinked-kernel
sudo kextcache -system-caches
</code></pre></div><p>最后重启</p><p>如果你需要禁用Trim：</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>sudo perl -pi -e <span class=s1>&#39;s|(\x52\x6F\x74\x61\x74\x69\x6F\x6E\x61\x6C\x00).{9}(\x00\x51)|$1\x41\x50\x50\x4C\x45\x20\x53\x53\x44$2|sg&#39;</span> /System/Library/Extensions/IOAHCIFamily.kext/Contents/PlugIns/IOAHCIBlockStorage.kext/Contents/MacOS/IOAHCIBlockStorage
sudo kextcache -system-prelinked-kernel
sudo kextcache -system-caches
</code></pre></div><p>如果出错，可以恢复备份的系统硬盘信息文件：</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>sudo cp /System/Library/Extensions/IOAHCIFamily.kext/Contents/PlugIns/IOAHCIBlockStorage.kext/Contents/MacOS/IOAHCIBlockStorage.original /System/Library/Extensions/IOAHCIFamily.kext/Contents/PzlugIns/IOAHCIBlockStorage.kext/Contents/MacOS/IOAHCIBlockStorage
</code></pre></div><h3 id=用noatime方式挂载系统盘>用noatime方式挂载系统盘</h3><blockquote>用 noatime 方式挂载系统盘，这样可以减少不必要的 I/O 次数，虽然 SSD 做这些操作非常快速，但考虑到最后访问时间这个属性其实很少用到，大家关心的一般都是最后修改时间和创建时间，所以完全可以关闭这个属性，这在 Unix/Linux 下是非常常见的文件系统优化选项。</blockquote><p>在<code>/Library/LaunchDaemons</code>先面创建一个<code>noatime.plist</code>,内容为：</p><script type=application/javascript src=https://gist.github.com/agassiyzh/1495283.js></script><p>记得修改权限：</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nv>$sudo</span> chown root:wheel /Library/LaunchDaemons/noatime.plist 
</code></pre></div><p>查看是否生效，可以输入下面的命令:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>mount <span class=p>|</span> grep <span class=s2>&#34; /
</span></code></pre></div><p>返回的结果应该是</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>/dev/disk0s2 on / <span class=o>(</span>hfs, local, journaled, noatime<span class=o>)</span>
</code></pre></div><p>注意有<code>noatime</code>了。</p><h3 id=ramdisk>RamDisk</h3><p>这个我现在还没有去碰。以前在win下搞过。蛋疼的时候再搞搞吧。</p><h2 id=榨干硬盘空间>榨干硬盘空间</h2><p>用了这么多年320G的硬盘，突然变成了128G，心理上感觉突然少了很多。</p><h3 id=关闭休眠>关闭休眠</h3><blockquote>默认的在 MB/MBP 上, 系统会在磁盘上维护一个和内存等大的 sleepimage 文件, 当电量耗尽时将内存中所有数据写入磁盘, 系统进入深度休眠状态, 下次唤醒时再从磁盘文件恢复状态. SSD 寸土寸金, 保留一个 8GB 大小又很少被用到的文件是很奢侈的行为.</blockquote><p>{% highlight bash linenos %}
$ sudo pmset -a hibernatemode 0</p><p>$ sudo rm /var/vm/sleepimage*</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>
### 关闭Time Machine本地备份

我在看容量的时候发现backup占了14G之多。我很奇怪我是把time machion在做移动硬盘上的。为什么备份会占用磁盘空间呢。google后发现我不知道怎么回事开启了本地备份功能。可以关闭本地备份来释放所占用的空间。

下面的命令可以做这件事：
```bash
$sudo tmutil disablelocal
</code></pre></div><h3 id=清理垃圾>清理垃圾</h3><p>跟<a href=https://weibo.com/xinquan>@xinquan</a>在Mac app store上买了个<a href="https://itunes.apple.com/cn/app/disk-diet/id445512770?l=en&mt=12">Disk Diet</a>。清理垃圾还是很方便的。</p><p><img src=https://pic.yupoo.com/agassi/BBtg3niP/medish.jpg alt></p><h2 id=拆下来的硬盘怎么办>拆下来的硬盘怎么办？</h2><p>我们都买了硬盘盒（ORICO 2598US），样子不错银白款的盒mac比较搭。重点是拆卸方便。</p><p><img src=https://www.orico.com.cn/images/20117122844739.jpg alt></p><h2 id=关于双硬盘-2011-12-21-159更新>关于双硬盘 2011-12-21 1:59更新</h2><p><a href=https://www.v2ex.com/member/Sivan>@Sivan</a>同学问我，如果是双硬盘，光驱位上装的是HDD怎么办，时候该开启紧急运动传感器。</p><p><a href=https://www.v2ex.com/member/ywjno>@ywjno</a>，光驱位是没有紧急运动传感器的。同时给了一篇比较专业的文章：<a href=https://apple4.us/2011/03/kill-cdrom-embrace-ssd.html>干掉光驱、拥抱 SSD</a>。</p></div><div class=post_footer></div></div><div class=doc_comments></div></div></div></div><a id=back_to_top href=# class=back_to_top><i class=ri-arrow-up-s-line></i></a><footer class=footer><div class=powered_by><a href=https://varkai.com>Designed by VarKai,</a>
<a href=http://www.gohugo.io/>Proudly published with Hugo</a></div><div class=footer_slogan><span>人生没有白走的路，每一步都算数</span></div></footer><script src=http://localhost:1313/js/jquery-3.5.1.min.js></script><link href=http://localhost:1313/css/fancybox.min.css rel=stylesheet><script src=http://localhost:1313/js/fancybox.min.js></script><script src=http://localhost:1313/js/zozo.js></script><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\[\[','\]\]']],processEscapes:true,processEnvironments:true,skipTags:['script','noscript','style','textarea','pre'],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}});MathJax.Hub.Queue(function(){var all=MathJax.Hub.getAllJax(),i;for(i=0;i<all.length;i+=1){all[i].SourceElement().parentNode.className+=' has-jax';}});</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style></body></html>